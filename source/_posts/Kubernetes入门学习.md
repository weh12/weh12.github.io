---
title: Kuberneteså…¥é—¨å­¦ä¹ 
date: 2024-11-03 19:00:02
categories: æ•™ç¨‹
tags: Kubernetes
cover: https://pic.imgdb.cn/item/67275883d29ded1a8c878153.jpg
---
## Kubernetesç®€ä»‹

Kubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°

![](https://pic.imgdb.cn/item/67273c87d29ded1a8c733732.png)

ç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯Kubernetesçš„ä¸€äº›å…³é”®ç‰¹æ€§å’Œæ¦‚å¿µï¼š

1. **å®¹å™¨ç¼–æ’**ï¼šKuberneteså¸®åŠ©ç”¨æˆ·ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬éƒ¨ç½²ã€è¿è¡Œã€æ‰©å±•ã€ç›‘æ§å’Œæ›´æ–°ã€‚
  
2. **æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡**ï¼šKuberneteså¯ä»¥ä¸ºå®¹å™¨æä¾›å†…éƒ¨å’Œå¤–éƒ¨çš„è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨å‘ç°æœåŠ¡ã€‚
  
3. **å­˜å‚¨ç¼–æ’**ï¼šKuberneteså…è®¸ç”¨æˆ·è‡ªåŠ¨æŒ‚è½½å­˜å‚¨ç³»ç»Ÿï¼Œæ— è®ºæ˜¯æœ¬åœ°ç£ç›˜ã€å…¬å…±äº‘æä¾›å•†çš„å­˜å‚¨è¿˜æ˜¯ç½‘ç»œå­˜å‚¨ç³»ç»Ÿã€‚
  
4. **è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š**ï¼šKubernetesæ”¯æŒå£°æ˜å¼çš„æ›´æ–°ï¼Œå¯ä»¥è‡ªåŠ¨å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¦‚æœæ–°ç‰ˆæœ¬å‡ºç°é—®é¢˜ã€‚
  
5. **è‡ªåŠ¨å®Œæˆå£°æ˜å¼éƒ¨ç½²**ï¼šç”¨æˆ·å¯ä»¥å£°æ˜ç³»ç»Ÿåº”æœ‰çš„çŠ¶æ€ï¼ŒKubernetesä¼šè‡ªåŠ¨å°†å½“å‰çŠ¶æ€å˜æ›´ä¸ºæœŸæœ›çŠ¶æ€ã€‚
  
6. **è‡ªåŠ¨é‡å¯**ï¼šå¦‚æœå®¹å™¨å´©æºƒï¼ŒKubernetesä¼šè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ã€‚
  
7. **è‡ªåŠ¨æ”¾ç½®**ï¼šKuberneteså¯ä»¥è‡ªåŠ¨å†³å®šåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œå®¹å™¨ï¼Œä»¥ä¼˜åŒ–èµ„æºåˆ©ç”¨ã€‚
  
8. **å¯†é’¥å’Œé…ç½®ç®¡ç†**ï¼šKuberneteså¯ä»¥å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç å’Œå¯†é’¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™å®¹å™¨ï¼Œè€Œæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²ã€‚
  
9. **æ‰©å±•æ€§**ï¼šKubernetesçš„APIä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾å¼€å‘è‡ªå®šä¹‰çš„æ‰©å±•æ’ä»¶ã€‚
  
10. **é›†ç¾¤è”é‚¦**ï¼šå¤šä¸ªKubernetesé›†ç¾¤å¯ä»¥ç»„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„å¤§é›†ç¾¤ï¼Œä»¥ä¾¿è·¨å¤šä¸ªäº‘æˆ–æ•°æ®ä¸­å¿ƒå…±äº«èµ„æºã€‚
  

Kubernetesçš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

- **Kubernetes Master**ï¼šè´Ÿè´£è°ƒåº¦Podsã€å¤„ç†é›†ç¾¤äº‹ä»¶ç­‰ã€‚
- **Node**ï¼šè¿è¡ŒPodsçš„æœºå™¨ã€‚
- **Pod**ï¼šKubernetesä¸­çš„åŸºæœ¬éƒ¨ç½²å•å…ƒï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚
- **Service**ï¼šå®šä¹‰äº†ä¸€ç§è®¿é—®Podçš„æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¨³å®šçš„æ¥å£ï¼Œå¯ä»¥è®¿é—®åˆ°Podsã€‚
- **Deployment**ï¼šç”¨äºæè¿°åº”ç”¨çš„æœŸæœ›çŠ¶æ€ï¼ŒåŒ…æ‹¬åº”ç”¨çš„å‰¯æœ¬æ•°ç­‰ã€‚
- **Ingress**ï¼šç®¡ç†å¤–éƒ¨è®¿é—®åº”ç”¨çš„è§„åˆ™ã€‚
- **Persistent Volume (PV) å’Œ Persistent Volume Claim (PVC)**ï¼šç”¨äºå­˜å‚¨çš„æŠ½è±¡ï¼Œå…è®¸Podsä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚
- **Namespace**ï¼šç”¨äºåœ¨åŒä¸€ä¸ªç‰©ç†é›†ç¾¤ä¸­éš”ç¦»ä¸åŒçš„ç”¨æˆ·æˆ–é¡¹ç›®ã€‚

Kubernetesçš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå¹³å°ï¼Œå®ƒèƒ½å¤Ÿè¿è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¹¶å…·æœ‰é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚å®ƒå·²ç»æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„äº‹å®æ ‡å‡†ï¼Œè¢«å¹¿æ³›åº”ç”¨äºç”Ÿäº§ç¯å¢ƒä¸­ã€‚

## Kubernetesç»„ä»¶

### NodeåŸºæœ¬ä¿¡æ¯

é¦–å…ˆä»ä¸€ä¸ªæœ€ç®€å•çš„èŠ‚ç‚¹å¼€å§‹, ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœº, åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªpod, Podæ˜¯kubernetesçš„æœ€å°è°ƒåº¦å•å…ƒ, ä¸€ä¸ªpodå°±æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨å®¹å™¨çš„ç»„åˆ, å®ƒåˆ›å»ºäº†ä¸€ä¸ªå®¹å™¨çš„è¿è¡Œç¯å¢ƒ, åœ¨è¿™ä¸ªç¯å¢ƒä¸­, å®¹å™¨å¯ä»¥å…±äº«ä¸€äº›èµ„æº, æ¯”å¦‚ç½‘ç»œ å­˜å‚¨ä»¥åŠä¸€äº›è¿è¡Œæ—¶çš„é…ç½®ç­‰

å‡è®¾æˆ‘ä»¬çš„ç³»ç»ŸåŒ…æ‹¬ä¸€ä¸ªåº”ç”¨ç¨‹åºå’Œä¸€ä¸ªæ•°æ®åº“, å°±å¯ä»¥å°†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“åˆ†åˆ«æ”¾åˆ°ä¸¤ä¸ªä¸åŒçš„podä¸­, ä¸€èˆ¬æƒ…å†µä¸‹, æˆ‘ä»¬å»ºè®®ä¸€ä¸ªpodä¸­åªè¿è¡Œä¸€ä¸ªå®¹å™¨, ä½†ä¸æ˜¯è¯´ä¸€ä¸ªpodä¸­åªèƒ½è¿è¡Œä¸€ä¸ªå®¹å™¨, å› ä¸ºè¿™æ ·æ˜¯ä¸ºäº†å®ç°åº”ç”¨ç¨‹åºçš„è§£è€¦å’Œæ‰©å±•, ä¸€ä¸ªpodå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨, ä½†æ˜¯ä¸€èˆ¬ä¹Ÿä»…é™äºè¿™äº›å®¹å™¨æ˜¯é«˜åº¦è€¦åˆçš„æƒ…å†µ, å®ƒä»¬ä¹‹é—´ä¸ºäº†å®ç°æŸç§åŠŸèƒ½æˆ–è€…å…±äº«æŸäº›èµ„æº, è€Œä¸å¾—ä¸æ”¾åˆ°åŒä¸€ä¸ªpodä¸­

![](https://s2.loli.net/2024/11/03/GCZUylR8YjpI3XB.png)

ç°åœ¨æˆ‘ä»¬å·²ç»å°†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“, åˆ†åˆ«æ”¾åˆ°äº†ä¸¤ä¸ªpodä¸­, åº”ç”¨ç¨‹åºè¦è®¿é—®æ•°æ®åº“çš„è¯, å°±éœ€è¦çŸ¥é“æ•°æ®åº“IPåœ°å€, è¿™ä¸ªIPåœ°å€æ˜¯åœ¨Podåˆ›å»ºçš„æ—¶å€™è‡ªåŠ¨åˆ†é…çš„, å®ƒæ˜¯ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„IPåœ°å€

Podä¹‹é—´å¯ä»¥é€šè¿‡è¿™ä¸ªIPåœ°å€æ¥è¿›è¡Œé€šä¿¡, è¿™æ ·æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡è¿™ä¸ªIPåœ°å€æ¥è®¿é—®æ•°æ®åº“äº†, ä½†æ˜¯è¿™ä¸ªæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ä¸€ä¸‹:

> ä¸€ä¸ªæ˜¯è¿™ä¸ªIPåœ°å€æ˜¯ä¸€ä¸ªå†…éƒ¨çš„IPåœ°å€, åœ¨é›†ç¾¤å¤–éƒ¨æ˜¯æ— æ³•è®¿é—®çš„

> äºŒæ˜¯podå¹¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šçš„å®ä½“, ä¹Ÿå°±æ„å‘³ç€å®ƒä»¬éå¸¸å®¹æ˜“è¢«åˆ›å»ºæˆ–è€…é”€æ¯, åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶å€™, Kubernetesä¼šè‡ªåŠ¨é”€æ¯podé‡æ–°åˆ›å»ºæ–°çš„podæ¥ä»£æ›¿å®ƒ, è¿™ä¸ªæ—¶å€™IPåœ°å€ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–

ä¸ºäº†è§£å†³é—®é¢˜äºŒ, Kubernetesæä¾›äº†ä¸€ä¸ªå«åš`Service`çš„èµ„æºå¯¹è±¡, å®ƒå¯ä»¥å°†ä¸€ç»„podå°è£…æˆä¸€ä¸ªæœåŠ¡, è¿™ä¸ªæœåŠ¡å¯ä»¥é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£æ¥è®¿é—®, æ‹¿åˆšæ‰çš„ä¾‹å­æ¥è¯´, æˆ‘ä»¬å¯ä»¥å°†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“çš„podåˆ†åˆ«å°è£…æˆä¸¤ä¸ªService(æœåŠ¡), è¿™æ ·åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡Serviceçš„IPåœ°å€æ¥è®¿é—®æ•°æ®åº“, å½“podå‘ç”Ÿæ•…éšœçš„æ—¶å€™, å³ä½¿å®ƒçš„IPåœ°å€å‘ç”Ÿäº†å˜åŒ–, ä½†Serviceçš„IPåœ°å€ä¸ä¼šå˜, Serviceä¼šè‡ªåŠ¨çš„è¯·æ±‚è½¬å‘åˆ°å…¶ä»–å¥åº·çš„podä¸Š, ä»¥æ­¤æ¥è§£å†³podçš„IPä¸ç¨³å®šçš„é—®é¢˜

### å†…éƒ¨å’Œå¤–éƒ¨æœåŠ¡

Serviceä¹Ÿåˆ†å†…éƒ¨æœåŠ¡å’Œå¤–éƒ¨æœåŠ¡, å†…éƒ¨æœåŠ¡æ˜¯ä¸€äº›æˆ‘ä»¬ä¸æƒ³æš´éœ²ç»™å¤–éƒ¨çš„æœåŠ¡, æ¯”å¦‚MySQLæ•°æ®åº“ ç¼“å­˜ æ¶ˆæ¯é˜Ÿåˆ—ç­‰ç­‰, è¿™äº›æœåŠ¡åªéœ€è¦åœ¨é›†ç¾¤å†…éƒ¨è¢«è®¿é—®å°±å¯ä»¥,

è€Œç›¸åº”çš„, æœ‰äº›æœåŠ¡æ˜¯è¦æš´éœ²ç»™å¤–éƒ¨çš„, æ¯”å¦‚ä¸€äº›å¾®æœåŠ¡çš„åç«¯APIæ¥å£æˆ–è€…æ˜¯ä¸€äº›ç»™ç”¨æˆ·ä½¿ç”¨çš„å‰ç«¯ç•Œé¢ç­‰ç­‰

å¤–éƒ¨æœåŠ¡æœ‰å‡ ç§å¸¸ç”¨çš„ç±»å‹, å…¶ä¸­ä¸€ç§ç±»å‹å°±æ˜¯**NodePort**, å®ƒä¼šåœ¨èŠ‚ç‚¹ä¸Šå¼€æ”¾ä¸€ä¸ªç«¯å£, ç„¶åå°†è¿™ä¸ªç«¯å£æ˜ å°„åˆ°Serviceçš„IPåœ°å€å’Œç«¯å£ä¸Š, è¿™æ ·å°±èƒ½é€šè¿‡èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£æ¥è®¿é—®Service, åœ¨å¼€å‘æˆ–è€…æµ‹è¯•é˜¶æ®µ, ä½¿ç”¨è¿™ç§IPå’Œç«¯å£å·çš„æ–¹å¼æ˜¯æ²¡æœ‰é—®é¢˜çš„, ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­, é€šå¸¸éƒ½æ˜¯é€šè¿‡åŸŸåæ¥è®¿é—®æœåŠ¡çš„, è¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº†å¦ä¸€ä¸ªèµ„æºå¯¹è±¡`Ingress`

Ingressæ˜¯ç”¨æ¥ç®¡ç†ä»é›†ç¾¤å¤–éƒ¨è®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡çš„å…¥å£å’Œæ–¹å¼çš„, å¯ä»¥é€šè¿‡Ingressæ¥é…ç½®ä¸åŒè½¬å‘è§„åˆ™, ä»è€Œæ ¹æ®ä¸åŒçš„è§„åˆ™æ¥è®¿é—®é›†ç¾¤å†…éƒ¨ä¸åŒçš„Serviceä»¥åŠServiceæ‰€å¯¹åº”çš„åç«¯pod, è¿˜å¯ä»¥é€šè¿‡Ingressæ¥é…ç½®åŸŸå, è¿™æ ·å°±å¯ä»¥å°†åŸæœ¬ä½¿ç”¨IPåœ°å€å’Œç«¯å£å·çš„æ–¹å¼, è½¬æ¢æˆä½¿ç”¨åŸŸåçš„æ–¹å¼æ¥è®¿é—®Service

å¦å¤–Ingressä¹Ÿå¯ä»¥é…ç½®ä¸€äº›å…¶ä»–åŠŸèƒ½, æ¯”å¦‚è´Ÿè½½å‡è¡¡ SSLè¯ä¹¦ç­‰ç­‰

### åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“çš„è€¦åˆé—®é¢˜

ä¸¾ä¸ªä¾‹å­, æ¯”å¦‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®æ•°æ®åº“, é€šå¸¸çš„åšæ³•æ˜¯æŠŠæ•°æ®åº“çš„åœ°å€å’Œç«¯å£ç­‰è¿æ¥ä¿¡æ¯å†™åˆ°é…ç½®æ–‡ä»¶æˆ–è€…ç¯å¢ƒå˜é‡ä¸­, ç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­è¯»å–è¿™äº›é…ç½®ä¿¡æ¯, ä½†æ˜¯è¿™æ ·çš„è¯é…ç½®ä¿¡æ¯å°±å’Œåº”ç”¨ç¨‹åºè€¦åˆåœ¨ä¸€èµ·äº†, ä¸€æ—¦æ•°æ®åº“çš„åœ°å€æˆ–è€…ç«¯å£å‘ç”Ÿäº†å˜åŒ–, é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é‡æ–°ç¼–è¯‘åº”ç”¨ç¨‹åº, ç„¶åå†é‡æ–°éƒ¨ç½²åˆ°é›†ç¾¤ä¸­, è¿™æ ·ä¸ä½†éå¸¸éº»çƒ¦, è€Œä¸”è¿˜ä¼šé€ æˆåº”ç”¨ç¨‹åºçš„åœæœºæ—¶é—´, è¿™å¯¹äºä¸€äº›éœ€è¦7x24å°æ—¶ä¸é—´æ–­è¿è¡Œçš„ç³»ç»Ÿæˆ–è€…æœåŠ¡æ¥è¯´, æ˜¾ç„¶æ˜¯ä¸èƒ½æ¥å—çš„,

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, kubernetesæä¾›äº†ä¸€ä¸ªå«åš`ConfigMap`çš„ç»„ä»¶, å®ƒå¯ä»¥å°†ä¸€äº›é…ç½®ä¿¡æ¯å°è£…èµ·æ¥, ç„¶åå°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è¯»å–å’Œä½¿ç”¨äº†

æœ‰äº†ConfigMap, æˆ‘ä»¬å°±å¯ä»¥æŠŠé…ç½®ä¿¡æ¯å’Œåº”ç”¨ç¨‹åºçš„é•œåƒå†…å®¹åˆ†ç¦»å¼€æ¥, è¿™æ ·å°±å¯ä»¥ä¿æŒå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¯ä»¥ç§»æ¤æ€§, å½“æ•°æ®åº“çš„åœ°å€å’Œç«¯å£å‘ç”Ÿå˜åŒ–çš„æ—¶å€™, æˆ‘ä»¬ä¹Ÿåªéœ€è¦ä¿®æ”¹ConfigMapå¯¹è±¡ä¸­çš„é…ç½®ä¿¡æ¯, ç„¶åé‡æ–°åŠ è½½podå°±è¡Œäº†, ä¸éœ€è¦é‡æ–°ç¼–è¯‘, è¿™æ ·å°±å®ç°äº†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“çš„è§£è€¦

> æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„åˆ°, ConfigMapä¸­çš„é…ç½®ä¿¡æ¯éƒ½æ˜¯æ˜æ–‡çš„, å¦‚æœé…ç½®ä¿¡æ¯ä¸­åŒ…å«äº†ä¸€äº›æ•æ„Ÿä¿¡æ¯, æ¯”å¦‚æ•°æ®åº“çš„ç”¨æˆ·åæˆ–è€…å¯†ç ç­‰ç­‰, é‚£ä¹ˆå°±ä¸å»ºè®®å­˜å‚¨åœ¨ConfigMap

ä¸ºäº†è§£å†³è¿™ä¸ªå°é—®é¢˜, Kubernetesæä¾›äº†å¦ä¸€ä¸ªå«åš`Secret`çš„ç»„ä»¶, å’ŒConfigMapç±»ä¼¼, å®ƒå¯ä»¥å°†ä¸€äº›æ•æ„Ÿä¿¡æ¯å°è£…èµ·æ¥, ç„¶åå°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å’Œè¯»å–äº†, Secretåªæ˜¯åšäº†Base64çš„ç¼–ç å¹¶æ²¡æœ‰åŠ å¯†, è¿˜è¦ä¾é Kubernetesçš„å…¶ä»–å®‰å…¨æœºåˆ¶æ¥ä¿è¯ç³»ç»Ÿå®‰å…¨

### æŒä¹…åŒ–å­˜å‚¨

å½“å®¹å™¨è¢«é”€æ¯æˆ–è€…é‡å¯çš„æ—¶å€™, å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè·Ÿç€æ¶ˆå¤±, è¿™å¯¹äºä¸€äº›éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„åº”ç”¨ç¨‹åº, æ¯”å¦‚æ•°æ®åº“æ¥è¯´æ˜¾ç„¶æ˜¯ä¸è¡Œçš„

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, Kubernetesæä¾›äº†ä¸€ä¸ªå«åš`Volume`çš„ç»„ä»¶, å®ƒå¯ä»¥å°†ä¸€äº›æŒä¹…åŒ–çš„èµ„æºæŒ‚è½½åˆ°é›†ç¾¤ä¸­çš„æœ¬åœ°ç£ç›˜ä¸Š, æˆ–è€…æŒ‚è½½åˆ°é›†ç¾¤å¤–éƒ¨çš„è¿œç¨‹å­˜å‚¨ä¸Š, è¿™æ ·å³ä½¿å®¹å™¨è¢«é”€æ¯æˆ–è€…é‡å¯, è¿™äº›æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±

### åº”ç”¨ç¨‹åºçš„é«˜å¯ç”¨æ€§

ä¸¾ä¸ªä¾‹å­, æ¯”å¦‚å¦‚æœåº”ç”¨ç¨‹åºæ‰€åœ¨çš„èŠ‚ç‚¹å‘ç”Ÿäº†æ•…éšœ, æˆ–è€…éœ€è¦å¯¹èŠ‚ç‚¹è¿›è¡Œå‡çº§å’Œæ›´æ–°ç»´æŠ¤çš„æ—¶å€™, åº”ç”¨ç¨‹åºå°±ä¼šåœæ­¢æœåŠ¡, è¿™æ ·å°±æœ‰å¯èƒ½é€ æˆä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦å’ŒæŸå¤±

è§£å†³æ–¹æ¡ˆå…¶å®ä¹Ÿéå¸¸ç®€å•, æ—¢ç„¶åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸è¡Œçš„è¯, é‚£ä¹ˆå°±å¤šåŠ å‡ ä¸ªèŠ‚ç‚¹, ç®€å•æ¥è¯´å°±æ˜¯æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½å¤åˆ¶ä¸€ä»½, ç„¶åæ”¾åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Š

Kubernetesæä¾›äº†ä¸€ä¸ªå«åš`Deployment`çš„ç»„ä»¶, å®ƒå¯ä»¥å®šä¹‰å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å‰¯æœ¬æ•°é‡ä»¥åŠåº”ç”¨ç¨‹åºçš„æ›´æ–°ç­–ç•¥, å¯ä»¥ç®€åŒ–åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œæ›´æ–°æ“ä½œ

åœ¨ä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡, podå¯ä»¥ç†è§£ä¸ºåœ¨å®¹å™¨çš„ä¸Šé¢åŠ äº†ä¸€å±‚æŠ½è±¡, è¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç»„åˆåœ¨ä¸€èµ·, è€ŒDeploymentå°±å¯ä»¥ç†è§£ä¸ºåœ¨podä¸Šå†åŠ ä¸Šä¸€å±‚æŠ½è±¡, è¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªpodç»„åˆåœ¨ä¸€èµ·, å¹¶ä¸”è¿˜å…·æœ‰å‰¯æœ¬æ§åˆ¶ æ»šåŠ¨æ›´æ–° è‡ªåŠ¨æ‰©ç¼©å®¹ç­‰é«˜çº§ç‰¹æ€§å’ŒåŠŸèƒ½

> å‰¯æœ¬æ§åˆ¶æ˜¯æŒ‡å¯ä»¥å®šä¹‰å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å‰¯æœ¬æ•°é‡, æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å‰¯æœ¬æ•°é‡ä¸º3ä¸ª, é‚£ä¹ˆå¦‚æœæœ‰å‰¯æœ¬å‘ç”Ÿæ•…éšœçš„æ—¶å€™, ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å‰¯æœ¬æ¥æ›¿ä»£å®ƒ

å¯¹äºç®¡ç†æ•°æ®åº“çš„æŒä¹…åŒ–, kubernetesæä¾›äº†å¦ä¸€ä¸ªç»„ä»¶å«`StatefulSet`æ¥ä¿è¯æ•°æ®åº“çš„é«˜å¯ç”¨æ€§, ç”¨æ³•æ ¹Deploymentç›¸ä¼¼

StatefulSeté€‚ç”¨äºéœ€è¦æŒä¹…åŒ–å­˜å‚¨ã€ç½‘ç»œæ ‡è¯†å’Œæœ‰åºæ“ä½œçš„åœºæ™¯ï¼Œä¾‹å¦‚æ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ RabbitMQã€Kafkaï¼‰å’Œåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿç­‰ã€‚

åˆ›å»ºStatefulSetçš„åŸºæœ¬ YAML æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: web
spec:
  serviceName: "nginx"
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: k8s.gcr.io/nginx-slim:0.8
        ports:
        - containerPort: 80
          name: web
        volumeMounts:
        - name: www
          mountPath: /usr/share/nginx/html
  volumeClaimTemplates:
  - metadata:
      name: www
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 1Gi
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º webçš„ StatefulSetï¼Œå®ƒç®¡ç†äº†ä¸‰ä¸ª nginx çš„Podï¼Œæ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªåä¸º www çš„æŒä¹…å·

## Kubernetesæ¶æ„

Kubernetesæ˜¯ä¸€ä¸ªå…¸å‹çš„Master-Workeræ¶æ„, Master-Nodeè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤, Worker-Nodeè´Ÿè´£è¿è¡Œåº”ç”¨ç¨‹åºå’ŒæœåŠ¡

![](https://pic.imgdb.cn/item/67279a45d29ded1a8ccee92f.png)

æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šçš„å®¹å™¨éƒ½æœ‰ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶container-runtime, åœ¨å­¦ä¹ Dockerçš„æ—¶å€™, æˆ‘ä»¬çŸ¥é“ä¹Ÿæœ‰ä¸€ä¸ªè¿è¡Œæ—¶Docker-Engine, åœ¨Kubernetesä¸­å¯ä»¥é€‰æ‹©ä»»ä½•ä½ æƒ³è¦çš„è¿è¡Œæ—¶

![](https://s2.loli.net/2024/11/03/15UYySw4EZkPNHc.png)

`kubelet`æ˜¯ Kubernetes é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä¸»è¦â€œèŠ‚ç‚¹ä»£ç†â€ï¼Œå®ƒè´Ÿè´£å¤„ç† Master èŠ‚ç‚¹ä¸‹å‘åˆ°æœ¬èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œç®¡ç† Pod å’Œå…¶ä¸­çš„å®¹å™¨ã€‚

`Kube-proxy`æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œä¸»è¦è´Ÿè´£å®ç°æœåŠ¡çš„ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚

> Master-Workeræ ¸å¿ƒç»„ä»¶

- `kube-apiserver` æ˜¯ Kubernetes é›†ç¾¤ä¸­çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œä¸»è¦è´Ÿè´£å¤„ç†æ‰€æœ‰ä¸ Kubernetes API çš„äº¤äº’ã€‚ä»¥ä¸‹æ˜¯å®ƒçš„ä¸€äº›å…³é”®ç‰¹æ€§å’ŒåŠŸèƒ½ï¼š
  

1. **API å¤„ç†**ï¼š`kube-apiserver` æä¾› Kubernetes å„ç±»èµ„æºå¯¹è±¡ï¼ˆå¦‚ Podã€Deploymentã€Service ç­‰ï¼‰çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥åŠ Watch ç­‰ HTTP REST æ¥å£[^1^]ã€‚å®ƒæ¥æ”¶å¹¶å“åº”æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆå¦‚ `kubectl`ã€åº”ç”¨ç¨‹åºã€å…¶ä»–ç»„ä»¶ç­‰ï¼‰çš„ RESTful API è¯·æ±‚ã€‚
  
2. **æ•°æ®å­˜å‚¨**ï¼š`kube-apiserver` ä¸ `etcd` äº¤äº’ï¼ŒæŒä¹…åŒ–ä¿å­˜é›†ç¾¤çš„çŠ¶æ€å’Œé…ç½®ã€‚å®ƒæ˜¯æ•´ä¸ª Kubernetes ç³»ç»Ÿçš„æ•°æ®æ€»çº¿å’Œæ•°æ®ä¸­å¿ƒã€‚
  
3. **è®¤è¯ä¸æˆæƒ**ï¼š`kube-apiserver` è¿›è¡Œèº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„ç”¨æˆ·å’Œç³»ç»Ÿç»„ä»¶èƒ½å¤Ÿå¯¹ Kubernetes èµ„æºè¿›è¡Œæ“ä½œã€‚å®ƒæä¾›äº†è®¤è¯ã€æˆæƒã€å‡†å…¥æ§åˆ¶ã€èµ„æºé…é¢ç­‰é›†ç¾¤å®‰å…¨æœºåˆ¶ã€‚
  
4. **æ¶æ„**ï¼š`kube-apiserver` çš„æ¶æ„å¯ä»¥åˆ†ä¸ºå››å±‚å’Œä¸€ä¸ªç›‘å¬æœºåˆ¶ï¼ŒåŒ…æ‹¬ API å±‚ã€è®¤è¯æˆæƒå±‚ã€å‡†å…¥æ§åˆ¶å±‚å’Œ etcd äº¤äº’å±‚ã€‚
  
5. **ç«¯å£**ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ`kube-apiserver` è¿›ç¨‹åœ¨æœ¬æœºçš„ 8080 ç«¯å£ï¼ˆå¯¹åº”å‚æ•° `--insecure-port`ï¼‰æä¾› REST æœåŠ¡ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶å¯åŠ¨ HTTPS å®‰å…¨ç«¯å£ï¼ˆ`--secure-port=6443`ï¼‰æ¥åŠ å¼º REST API è®¿é—®çš„å®‰å…¨æ€§ã€‚
  
6. **å·¥ä½œåŸç†**ï¼š`kube-apiserver` æä¾›äº† Kubernetes çš„ REST APIï¼Œå®ç°äº†è®¤è¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶ç­‰å®‰å…¨åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£äº†é›†ç¾¤çŠ¶æ€çš„å­˜å‚¨æ“ä½œã€‚
  
7. **è®¿é—®æ–¹å¼**ï¼šå¯ä»¥é€šè¿‡ `kubectl` å‘½ä»¤è¡Œå·¥å…·ã€å®¢æˆ·ç«¯åº“å’Œç¬¬ä¸‰æ–¹å·¥å…·ä¸ Kubernetes é›†ç¾¤è¿›è¡Œäº¤äº’ã€‚
  

`kube-apiserver` ä½œä¸º Kubernetes é›†ç¾¤çš„ä¸­æ¢ï¼Œæ‰€æœ‰å¯¹é›†ç¾¤çŠ¶æ€çš„æ“ä½œéƒ½é€šè¿‡å®ƒæ¥è¿›è¡Œï¼Œå› æ­¤å®ƒçš„åœ°ä½éå¸¸é‡è¦ã€‚

- `Scheduler`æ˜¯ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œè´Ÿè´£å°†Podsï¼ˆå®¹å™¨çš„é€»è¾‘å°è£…ï¼‰è°ƒåº¦åˆ°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸Šã€‚å®ƒéœ€è¦è€ƒè™‘èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™ã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´å¹²æ‰°å’Œæœ€ç»ˆç”¨æˆ·æŒ‡å®šçš„è°ƒåº¦è¦æ±‚ã€‚
  
- `Controller Manager`æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦è´Ÿè´£ç®¡ç†é›†ç¾¤ä¸­çš„å„ç§Podï¼Œä»¥ç¡®ä¿é›†ç¾¤çš„å®é™…çŠ¶æ€ä¸ç”¨æˆ·çš„æœŸæœ›çŠ¶æ€ä¿æŒä¸€è‡´ã€‚
  
- `etcd`æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºå…±äº«é…ç½®å’ŒæœåŠ¡å‘ç°ã€‚
  

ä»¥ä¸‹æ˜¯etcdçš„ä¸€äº›æ ¸å¿ƒç»„ä»¶å’Œå®ƒä»¬çš„ä½œç”¨ï¼š

1. **Clientå±‚**ï¼šåŒ…å«client v2å’Œv3ä¸¤ä¸ªå¤§ç‰ˆæœ¬çš„APIå®¢æˆ·ç«¯ï¼Œç”¨äºå®¢æˆ·ç«¯ä¸etcdæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚
  
2. **APIç½‘ç»œå±‚**ï¼šä¸»è¦åŒ…å«å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨å’ŒæœåŠ¡å™¨èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡åè®®ã€‚å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼šv2 
  APIé‡‡ç”¨HTTP/1.xåè®®ï¼Œv3 
  APIé‡‡ç”¨gRPCåè®®ï¼›æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯æŒ‡èŠ‚ç‚¹é—´é€šè¿‡Raftç®—æ³•å®ç°æ•°æ®å¤åˆ¶å’ŒLeaderé€‰ä¸¾ç­‰åŠŸèƒ½æ—¶ä½¿ç”¨çš„HTTPåè®®ã€‚
  
3. **Raftç®—æ³•å±‚**ï¼šå®ç°äº†Leaderé€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€ReadIndexç­‰æ ¸å¿ƒç®—æ³•ç‰¹æ€§ï¼Œç”¨äºä¿éšœetcdå¤šèŠ‚ç‚¹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€æå‡æœåŠ¡å¯ç”¨æ€§ç­‰ï¼Œæ˜¯etcdçš„åŸºçŸ³å’Œäº®ç‚¹ã€‚
  
4. **åŠŸèƒ½é€»è¾‘å±‚**ï¼šetcdæ ¸å¿ƒç‰¹æ€§å®ç°å±‚ï¼Œå¦‚å…¸å‹çš„KVServeræ¨¡å—ã€MVCCæ¨¡å—ã€Authé‰´æƒæ¨¡å—ã€Leaseç§Ÿçº¦æ¨¡å—ã€Compactorå‹ç¼©æ¨¡å—ç­‰ã€‚å…¶ä¸­MVCCæ¨¡å—ä¸»è¦æœ‰treeIndexæ¨¡å—å’Œboltdbæ¨¡å—ç»„æˆã€‚
  
5. **å­˜å‚¨å±‚**ï¼šåŒ…å«é¢„å†™æ—¥å¿—WALæ¨¡å—ã€å¿«ç…§Snapshotæ¨¡å—ã€boltdbæ¨¡å—ã€‚WALå¯ä¿éšœetcd crashåæ•°æ®ä¸ä¸¢å¤±ï¼Œboltdbåˆ™ä¿å­˜äº†é›†ç¾¤å…ƒæ•°æ®å’Œç”¨æˆ·å†™å…¥çš„æ•°æ®ã€‚
  

etcdçš„ç‰¹ç‚¹åŒ…æ‹¬ç®€å•æ€§ã€é”®å€¼å¯¹å­˜å‚¨ã€ç›‘æµ‹å˜æ›´ã€å®‰å…¨æ€§ã€å¿«é€Ÿæ€§å’Œå¯é æ€§ã€‚

## minikubeæ­å»ºç¯å¢ƒ

![](https://s2.loli.net/2024/11/04/Vd4ejir1FTXSRA3.png)
é™¤äº†æ­å»ºä¸€ä¸ªkubernetesé›†ç¾¤ç¯å¢ƒä¹‹å¤–, ä½ è¿˜éœ€è¦ä½¿ç”¨`kubectl`è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥åŒä½ åˆ›å»ºçš„kubernetesé›†ç¾¤è¿›è¡Œäº¤äº’, æ¯”å¦‚åˆ›å»ºä¸€ä¸ªPodæˆ–è€…ServiceæŸ¥çœ‹é›†ç¾¤çš„çŠ¶æ€ç­‰ç­‰

### åŸºæœ¬å®‰è£…æµç¨‹

ä»¥ä¸‹æ˜¯åœ¨ä½ çš„ç”µè„‘ä¸Šä½¿ç”¨ Minikube æ­å»ºå¼€å‘ç¯å¢ƒçš„æ­¥éª¤ï¼š

#### å®‰è£… prerequisites

1. **Docker**: Minikube éœ€è¦ Docker æ¥è¿è¡Œè™šæ‹Ÿæœºæˆ–è€…å®¹å™¨ã€‚
  
  - [ä¸‹è½½å¹¶å®‰è£… Docker](https://docs.docker.com/get-docker/)
2. **kubectl**:
  
  - [ä» Minikube å®˜æ–¹ç½‘ç«™å®‰è£… 
    kubectl](https://minikube.sigs.k8s.io/docs/start/kubectl/)
3. **VirtualBox æˆ– VMware** (å¦‚æœéœ€è¦è™šæ‹Ÿæœºæ”¯æŒ):
  
  - [å®‰è£… VirtualBox](https://www.virtualbox.org/wiki/Downloads) æˆ– 
    [VMware](https://www.vmware.com/products/workstation/index.html)

#### å®‰è£… Minikube

1. æ‰“å¼€ç»ˆç«¯ã€‚
  
2. è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… Minikubeï¼š
  
  ```bash
  sudo curl -LO 
  https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd6https://storage.googleapis.com/minikube/releases/latest/mnikube-linux-amd64
  sudo chmod +x minikube-linux-amd64
  sudo mv minikube-linux-amd64 /usr/local/bin/minikube
  ```
  

#### å¯åŠ¨ Minikube

1. åˆ‡æ¢åˆ°å…·æœ‰ç›¸åº”æƒé™çš„ç›®å½•ã€‚
  
2. è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Minikubeï¼š
  
  ```bash
  # å›½å†…ç”¨æˆ·ç¬¬ä¸€æ¬¡ä¸‹è½½å¯èƒ½ä¼šé‡åˆ°ä¾èµ–ä¸‹è½½å¤±è´¥çš„æƒ…å†µ, å¯ä»¥åˆ‡æ¢å›½å†…é•œåƒæºä¸‹è½½
  # åŠ ä¸Š--image-mirror-country=cnå‚æ•°
  minikube start --image-mirror-country=cn
  ```
  
3. ä½ å¯ä»¥åœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­è¿è¡Œ `kubectl cluster-info` æ£€æŸ¥é›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚
  

#### éƒ¨ç½²åº”ç”¨ç¨‹åº

1. ä½¿ç”¨ `kubectl apply -f <your-deployment.yaml>` å‘½ä»¤éƒ¨ç½²ä½ çš„åº”ç”¨ï¼ˆå‡è®¾ä½ æœ‰
  ä¸€ä¸ªå·²å®šä¹‰çš„ Kubernetes Deployment YAML æ–‡ä»¶ï¼‰ã€‚
  
2. ç¡®è®¤éƒ¨ç½²æ˜¯å¦æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
  
  ```bash
  kubectl get pods
  ```
  
3. ä½ å¯ä»¥é€šè¿‡è®¿é—® Minikube æŒ‡å®šçš„ IP åœ°å€æ¥æµ‹è¯•åº”ç”¨ç¨‹åºã€‚
  

#### åœæ­¢ Minikube

å½“ä½ å®Œæˆå¼€å‘å·¥ä½œåï¼Œä½ å¯ä»¥åœæ­¢ Minikubeï¼š

```bash
minikube stop
```

#### åˆ é™¤ Minikube

å¦‚æœä½ æƒ³è¦ä»ç³»ç»Ÿä¸­å®Œå…¨åˆ é™¤ Minikubeï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
minikube delete
```

ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ Minikube åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæ­å»º Kubernetes å¼€å‘ç¯å¢ƒçš„æ­¥éª¤ã€‚
Minikube ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ Kubernetes ç¯å¢ƒï¼Œå¯ä»¥åœ¨ä¸ç¦»å¼€æœ¬åœ°ç¯å¢ƒçš„æƒ…
å†µä¸‹æµ‹è¯•å’Œå¼€å‘åº”ç”¨ç¨‹åºã€‚

### ubuntuä¸Šæ­å»ºminikube

åœ¨ Ubuntu 22 ä¸Šå®‰è£… Minikube
**å®‰è£…ä¾èµ–**

é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ç³»ç»Ÿå®‰è£…äº†å¿…è¦çš„ä¾èµ–é¡¹ï¼š

```
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl
```

**å®‰è£… Docker**

Minikube å¯ä»¥ä½¿ç”¨ Docker ä½œä¸ºå…¶è™šæ‹ŸåŒ–é©±åŠ¨ç¨‹åºã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®‰è£… Dockerï¼š

```
sudo apt-get install -y docker.io
sudo systemctl start docker
sudo systemctl enable docker
```

éªŒè¯ Docker æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```
docker --version
```

ç¤ºä¾‹è¾“å‡ºï¼š

```
Docker version 20.10.7, build f0df350
```

**ä½¿ç”¨å›½å†…é•œåƒå®‰è£… kubectl**

ç”±äºç½‘ç»œåŸå› æ— æ³•è®¿é—® Google çš„ Kubernetes å­˜å‚¨åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Azure China çš„ Kubernetes é•œåƒæºæ¥ä¸‹è½½å’Œå®‰è£… kubectlï¼š

```
1.è·å–ç¨³å®šç‰ˆæœ¬å·ï¼š

VERSION=$(curl -s https://mirror.azure.cn/kubernetes/kubectl/stable.txt)
echo $VERSION

ç¤ºä¾‹è¾“å‡ºï¼š

v1.22.0

2.ä¸‹è½½ kubectlï¼š

curl -LO "https://mirror.azure.cn/kubernetes/kubectl/$VERSION/bin/linux/amd64/kubectl"

3.å®‰è£… kubectlï¼š

sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

4.éªŒè¯å®‰è£…ï¼š

kubectl version --client

ç¤ºä¾‹è¾“å‡ºï¼š

Client Version: version.Info{Major:"1", Minor:"22", GitVersion:"v1.22.0", GitCommit:"abcdef", GitTreeState:"clean", BuildDate:"2022-07-15T12:00:00Z", GoVersion:"go1.16.5", Compiler:"gc", Platform:"linux/amd64"}
```

**å®‰è£… Minikube**

ä» Minikube çš„å®˜æ–¹ç½‘ç«™ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Minikubeï¼š

```
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube
```

éªŒè¯ Minikube æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```
minikube version
```

ç¤ºä¾‹è¾“å‡ºï¼š

```
minikube version: v1.33.1
commit: 2f223910e89575eb6b2cf301748c1126d88a1585
```

**å¯åŠ¨ Minikube**

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Minikubeï¼š

```
minikube start --driver=docker
```

ç¤ºä¾‹è¾“å‡ºï¼š

```
ğŸ˜„ minikube v1.33.1 on Ubuntu 22.04 (vbox/amd64)
âœ¨ Using the docker driver based on user configuration
ğŸ‘ Starting control plane node minikube in cluster minikube
ğŸšœ Pulling base image ...
ğŸ”¥ Creating docker container (CPUs=2, Memory=4000MB) ...
ğŸ³ Preparing Kubernetes v1.23.3 on Docker 20.10.7 ...
 â–ª kubelet.housekeeping-interval=5m
ğŸš€ Launching Kubernetes ...
 â–ª apiserver.advertise-address=192.168.99.100
ğŸŒŸ Enabling addons: default-storageclass, storage-provisioner
ğŸ„ Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
```

**å¯ç”¨ Ingress æ’ä»¶**

ä¸ºäº†ä½¿å±€åŸŸç½‘å†…çš„å…¶ä»–æœºå™¨èƒ½å¤Ÿè®¿é—® Minikube Dashboardï¼Œä½ éœ€è¦å¯ç”¨ Ingress æ’ä»¶ï¼š

```
minikube addons enable ingress
```

ç¤ºä¾‹è¾“å‡ºï¼š

```
ğŸ’¡ ingress is an addon maintained by Kubernetes. For any concerns contact minikube on GitHub.
You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS
 â–ª Using image registry.k8s.io/ingress-nginx/controller:v1.10.1
 â–ª Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.1
 â–ª Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.1
ğŸ” Verifying ingress addon...
ğŸŒŸ The 'ingress' addon is enabled
```

è®©å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨è®¿é—® Minikube Dashboard

> ä½¿ç”¨ `kubectl port-forward`:

- 1.è·å– Dashboard æœåŠ¡åç§°ï¼š

```
kubectl get svc -n kubernetes-dashboard
```

ç¤ºä¾‹è¾“å‡º:

```
NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
kubernetes-dashboard   ClusterIP   10.96.183.235    <none>        80/TCP    10m
```

- 2.è¿›è¡Œç«¯å£è½¬å‘ï¼š

```
kubectl port-forward -n kubernetes-dashboard service/kubernetes-dashboard 8080:80 --address 0.0.0.0 &
```

- 3.åœ¨å±€åŸŸç½‘å†…çš„å…¶ä»–æœºå™¨ä¸Šï¼Œé€šè¿‡ä»¥ä¸‹ URL è®¿é—® Dashboardï¼š

```
http://<your-host-ip>:8080/
```

å…¶ä¸­ `<your-host-ip>` æ˜¯è¿è¡Œ Minikube çš„ä¸»æœºçš„ IP åœ°å€ã€‚

å¦‚æœéœ€è¦åå°è¿è¡Œï¼Œå¯ä»¥ç”¨nohupå‘½ä»¤ï¼š

```
nohup kubectl port-forward -n kubernetes-dashboard service/kubernetes-dashboard 8080:80 --address 0.0.0.0 > port-forward.log 2>&1 &
```

**è®¾ç½®é˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰**

å¦‚æœä½ åœ¨æœºå™¨ä¸Šå¯ç”¨äº†é˜²ç«å¢™ï¼Œå¯èƒ½éœ€è¦å¼€æ”¾ç›¸åº”çš„ç«¯å£ï¼š

```
sudo ufw allow 8001
```

## ä½¿ç”¨K3så’ŒMultipassæ­å»ºç¯å¢ƒ

### Multipassæ˜¯ä»€ä¹ˆ?

Multipass æ˜¯ä¸€ä¸ªå¼€æºçš„è™šæ‹ŸåŒ–å·¥å…·ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªå®‰å…¨çš„æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªæ²™ç®±ç¯å¢ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„è™šæ‹Ÿæœºï¼ˆVMï¼‰ï¼Œå¯ä»¥ç”¨äºå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œè€Œä¸å¿…æ‹…å¿ƒä¼šå½±å“å®¿ä¸»æœºå™¨çš„ç³»ç»Ÿç¯å¢ƒã€‚

Multipass é€‚ç”¨äºéœ€è¦éš”ç¦»å¼€å‘ç¯å¢ƒæˆ–æµ‹è¯•åº”ç”¨ç¨‹åºçš„åœºåˆï¼Œå°¤å…¶æ˜¯å¯¹äºé‚£äº›å¸Œæœ›åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¹‹é—´ä¿æŒä¸€è‡´æ€§å¼€å‘æµç¨‹çš„å¼€å‘è€…æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚

### å®‰è£…å’Œä½¿ç”¨Multipass

![](https://pic.imgdb.cn/item/6739e3f3d29ded1a8cb0e23f.png)

ä½¿ç”¨ Multipass åˆ›å»ºè™šæ‹Ÿæœºçš„å…·ä½“è¯­æ³•ç›¸å¯¹ç®€å•ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Multipass å‘½ä»¤å’Œå‚æ•°ï¼š

SHELL

`multipass launch [OPTIONS]`

ä»¥ä¸‹æ˜¯Â `launch`Â å‘½ä»¤çš„ä¸€äº›å¸¸è§é€‰é¡¹ï¼š

- `-n`,Â `--name NAME`ï¼šæŒ‡å®šè™šæ‹Ÿæœºçš„åç§°ã€‚
- `-i`,Â `--image IMAGENAME`ï¼šæŒ‡å®šè¦å¯åŠ¨çš„é•œåƒåç§°ã€‚å¦‚æœä½ ä¸æä¾›è¿™ä¸ªé€‰é¡¹ï¼ŒMultipass å°†ä½¿ç”¨é»˜è®¤çš„å®˜æ–¹é•œåƒã€‚
- `-m`,Â `--memory MEMORY`ï¼šæŒ‡å®šåˆ†é…ç»™è™šæ‹Ÿæœºçš„å†…å­˜å¤§å°ï¼ˆä»¥ MB ä¸ºå•ä½ï¼‰ã€‚
- `-c`,Â `--cpus CPUS`ï¼šæŒ‡å®šè™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨çš„ CPU æ ¸å¿ƒæ•°ã€‚
- `-d`,Â `--disk SIZE`ï¼šæŒ‡å®šåˆå§‹ç£ç›˜å¤§å°ï¼ˆä»¥ GB ä¸ºå•ä½ï¼‰ã€‚
- `--vm-type TYPE`ï¼šæŒ‡å®šè™šæ‹Ÿæœºçš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ"normal"ï¼Œ"headless" ç­‰ï¼‰ã€‚
- `--cloud-init CLOUDINIT`ï¼šä½¿ç”¨ cloud-init è„šæœ¬æ¥è‡ªå®šä¹‰è™šæ‹Ÿæœºè®¾ç½®ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ›å»ºè™šæ‹Ÿæœºçš„å…·ä½“ä¾‹å­ï¼š

SHELL

`multipass launch -n my-vm --image ubuntu latest --memory 2048 --cpus 2`

è¿™ä¸ªå‘½ä»¤å°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º "my-vm" çš„ Ubuntu è™šæ‹Ÿæœºï¼Œåˆ†é… 2048MB çš„å†…å­˜å’Œ 2 ä¸ª CPU æ ¸å¿ƒã€‚

å¦‚æœä½ æƒ³å¯¼å…¥ä¸€ä¸ªç‰¹å®šçš„æ“ä½œç³»ç»Ÿé•œåƒå¹¶ä¸”è®¾ç½®ç£ç›˜å¤§å°å’Œç±»å‹ï¼ˆä¾‹å¦‚ SSDï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

SHELL

`multipass launch -n my-vm --image ubuntu latest --disk-size 30G --storage-engine lvm`

è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º "my-vm" çš„è™šæ‹Ÿæœºï¼Œä½¿ç”¨ Ubuntu é•œåƒçš„æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼Œåˆ†é… 30GB çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶é€‰æ‹© LVM ä½œä¸ºå­˜å‚¨å¼•æ“ã€‚

> å…¶ä»–å¸¸ç”¨ Multipass å‘½ä»¤

- `multipass shell NAME`ï¼šè¿›å…¥æŒ‡å®šæ²™ç›’çš„ç»ˆç«¯ã€‚
- `multipass info NAME`ï¼šè·å–å…³äºæŒ‡å®šæ²™ç›’çš„ä¿¡æ¯ã€‚
- `multipass mount [OPTIONS] FILE|DIR [MOUNTPOINT]`ï¼šæŒ‚è½½æ–‡ä»¶æˆ–ç›®å½•åˆ°æ²™ç›’ä¸­ã€‚
- `multipass umount NAME MOUNTPOINT`ï¼šä»æ²™ç›’å¸è½½å·²æŒ‚è½½çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚
- `multipass delete NAME`ï¼šåˆ é™¤æŒ‡å®šçš„æ²™ç›’ã€‚
- `multipass list`ï¼šåˆ—å‡ºæ‰€æœ‰åˆ›å»ºçš„æ²™ç›’ã€‚

![](https://pic.imgdb.cn/item/6739e720d29ded1a8cb36695.png)

multipassé»˜è®¤æ˜¯ä¸å…è®¸ç›´æ¥é€šè¿‡sshè¿›å…¥çš„, éœ€è¦é…ç½®ssh

![](https://pic.imgdb.cn/item/6739e7ded29ded1a8cb409e3.png)

### K3så®‰è£…å’Œä½¿ç”¨

#### K3sä»‹ç»

[k3s](https://k3s.io/) æ˜¯ä¸€ä¸ªè½»é‡çº§çš„[Kubernetes](https://kubernetes.io/)å‘è¡Œç‰ˆï¼Œå®ƒæ˜¯ [Rancher Labs](https://www.rancher.com/) æ¨å‡ºçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œ  
æ—¨åœ¨ç®€åŒ–[Kubernetes](https://kubernetes.io/)çš„å®‰è£…å’Œç»´æŠ¤ï¼ŒåŒæ—¶å®ƒè¿˜æ˜¯CNCFè®¤è¯çš„[Kubernetes](https://kubernetes.io/)å‘è¡Œç‰ˆã€‚

æœ¬æŒ‡å—å¸®åŠ©ä½ ä½¿ç”¨é»˜è®¤é€‰é¡¹å¿«é€Ÿå¯åŠ¨é›†ç¾¤ã€‚[å®‰è£…éƒ¨åˆ†](https://docs.k3s.io/zh/installation)æ›´è¯¦ç»†åœ°ä»‹ç»äº†å¦‚ä½•è®¾ç½® K3sã€‚

æœ‰å…³ K3s ç»„ä»¶å¦‚ä½•ååŒå·¥ä½œçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…[æ¶æ„](https://docs.k3s.io/zh/architecture)ã€‚

Kubernetes æ–°æ‰‹ï¼ŸKubernetes å®˜æ–¹æ–‡æ¡£ä»‹ç»äº†ä¸€äº›å¾ˆå¥½çš„[åŸºç¡€çŸ¥è¯†æ•™ç¨‹](https://kubernetes.io/docs/tutorials/kubernetes-basics/)ã€‚

#### å®‰è£…è„šæœ¬

K3s æä¾›äº†ä¸€ä¸ªå®‰è£…è„šæœ¬ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†å…¶ä½œä¸ºæœåŠ¡å®‰è£…åœ¨åŸºäº systemd æˆ– openrc çš„ç³»ç»Ÿä¸Šã€‚è¯¥è„šæœ¬å¯åœ¨ [https://get.k3s.io](https://get.k3s.io) è·å¾—ã€‚è¦ä½¿ç”¨è¿™ç§æ–¹æ³•å®‰è£… K3sï¼Œåªéœ€è¿è¡Œï¼š

```
curl -sfL https://get.k3s.io | sh -
```

> å¤‡æ³¨: ä¸­å›½ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åŠ é€Ÿå®‰è£…ï¼š

```
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -
```

è¿è¡Œæ­¤å®‰è£…åï¼š

- K3s æœåŠ¡å°†è¢«é…ç½®ä¸ºåœ¨èŠ‚ç‚¹é‡å¯åæˆ–è¿›ç¨‹å´©æºƒæˆ–è¢«æ€æ­»æ—¶è‡ªåŠ¨é‡å¯ã€‚
- å°†å®‰è£…å…¶ä»–å®ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ `kubectl`ã€`crictl`ã€`ctr`ã€`k3s-killall.sh` å’Œ `k3s-uninstall.sh`ã€‚
- [kubeconfig](https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/) æ–‡ä»¶å°†å†™å…¥åˆ° `/etc/rancher/k3s/k3s.yaml`ï¼Œç”± K3s å®‰è£…çš„ kubectl å°†è‡ªåŠ¨ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚

å•èŠ‚ç‚¹ Server å®‰è£…æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ Kubernetes é›†ç¾¤ï¼Œå®ƒåŒ…æ‹¬äº†æ‰˜ç®¡å·¥ä½œè´Ÿè½½ pod æ‰€éœ€çš„æ‰€æœ‰æ•°æ®å­˜å‚¨ã€control 
planeã€kubelet å’Œå®¹å™¨è¿è¡Œæ—¶ç»„ä»¶ã€‚é™¤éä½ å¸Œæœ›å‘é›†ç¾¤æ·»åŠ å®¹é‡æˆ–å†—ä½™ï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦æ·»åŠ é¢å¤–çš„ Server æˆ– Agent èŠ‚ç‚¹ã€‚

è¦å®‰è£…å…¶ä»– Agent èŠ‚ç‚¹å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°é›†ç¾¤ï¼Œè¯·ä½¿ç”¨ `K3S_URL` å’Œ `K3S_TOKEN` ç¯å¢ƒå˜é‡è¿è¡Œå®‰è£…è„šæœ¬ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•æ·»åŠ  Agent èŠ‚ç‚¹ï¼š

```
curl -sfL https://get.k3s.io | K3S_URL=https://myserver:6443 K3S_TOKEN=mynodetoken sh -
```

> å¤‡æ³¨: ä¸­å›½ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åŠ é€Ÿå®‰è£…ï¼š

```
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=https://myserver:6443 K3S_TOKEN=mynodetoken sh -
```

`K3S_URL` å‚æ•°ä¼šå¯¼è‡´å®‰è£…ç¨‹åºå°† K3s é…ç½®ä¸º Agent è€Œä¸æ˜¯ Serverã€‚K3s Agent å°†æ³¨å†Œåˆ°åœ¨ URL ä¸Šç›‘å¬çš„ K3s Serverã€‚`K3S_TOKEN` ä½¿ç”¨çš„å€¼å­˜å‚¨åœ¨ Server èŠ‚ç‚¹ä¸Šçš„ `/var/lib/rancher/k3s/server/node-token` ä¸­ã€‚

> å¤‡æ³¨: æ¯å°ä¸»æœºå¿…é¡»å…·æœ‰å”¯ä¸€çš„ä¸»æœºåã€‚å¦‚æœä½ çš„è®¡ç®—æœºæ²¡æœ‰å”¯ä¸€çš„ä¸»æœºåï¼Œè¯·ä¼ é€’ `K3S_NODE_NAME` ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹æä¾›ä¸€ä¸ªæœ‰æ•ˆä¸”å”¯ä¸€çš„ä¸»æœºåã€‚

#### åˆ›å»ºå’Œé…ç½®masterèŠ‚ç‚¹

é¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨multipassåˆ›å»ºä¸€ä¸ªåå­—å«åšk3sçš„è™šæ‹Ÿæœºï¼Œ

```bash
multipass launch --name k3s --cpus 2 --memory 8G --disk 10G
```

è™šæ‹Ÿæœºåˆ›å»ºå®Œæˆä¹‹åï¼Œ  
å¯ä»¥é…ç½®SSHå¯†é’¥ç™»å½•ï¼Œ  
ä¸è¿‡è¿™ä¸€æ­¥å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œ  
å³ä½¿ä¸é…ç½®ä¹Ÿå¯ä»¥é€šè¿‡`multipass exec`æˆ–è€…`multipass shell`å‘½ä»¤æ¥è¿›å…¥è™šæ‹Ÿæœºï¼Œ  
ç„¶åæˆ‘ä»¬éœ€è¦åœ¨masterèŠ‚ç‚¹ä¸Šå®‰è£…[k3s](https://k3s.io/)ï¼Œ

ä½¿ç”¨[k3s](https://k3s.io/)æ­å»ºkubernetesé›†ç¾¤éå¸¸ç®€å•ï¼Œ  
åªéœ€è¦æ‰§è¡Œä¸€æ¡å‘½ä»¤å°±å¯ä»¥åœ¨å½“å‰èŠ‚ç‚¹ä¸Šå®‰è£…[k3s](https://k3s.io/)ï¼Œ  
æ‰“å¼€åˆšåˆšåˆ›å»ºçš„k3sè™šæ‹Ÿæœºï¼Œ  
æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å®‰è£…ä¸€ä¸ª[k3s](https://k3s.io/)çš„masterèŠ‚ç‚¹ï¼Œ

```bash
# å®‰è£…k3sçš„masterèŠ‚ç‚¹
curl -sfL https://get.k3s.io | sh -
```

å›½å†…ç”¨æˆ·å¯ä»¥æ¢æˆä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿ç”¨ranherçš„é•œåƒæºæ¥å®‰è£…ï¼š

```bash
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -
```

å®‰è£…å®Œæˆä¹‹åï¼Œå¯ä»¥é€šè¿‡`kubectl`å‘½ä»¤æ¥æŸ¥çœ‹é›†ç¾¤çš„çŠ¶æ€ï¼Œ

```bash
sudo kubectl get nodes
```

#### åˆ›å»ºå’Œé…ç½®workerèŠ‚ç‚¹

æ¥ä¸‹æ¥éœ€è¦åœ¨è¿™ä¸ªmasterèŠ‚ç‚¹ä¸Šè·å–ä¸€ä¸ªtokenï¼Œ  
ç”¨æ¥ä½œä¸ºåˆ›å»ºworkerèŠ‚ç‚¹æ—¶çš„ä¸€ä¸ªè®¤è¯å‡­è¯ï¼Œ  
å®ƒä¿å­˜åœ¨`/var/lib/rancher/k3s/server/node-token`è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œ  
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`sudo cat`å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œ

```bash
sudo cat /var/lib/rancher/k3s/server/node-token
```

å°†TOKENä¿å­˜åˆ°ä¸€ä¸ªç¯å¢ƒå˜é‡ä¸­

```bash
TOKEN=$(multipass exec k3s sudo cat /var/lib/rancher/k3s/server/node-token)
```

ä¿å­˜masterèŠ‚ç‚¹çš„IPåœ°å€

```bash
MASTER_IP=$(multipass info k3s | grep IPv4 | awk '{print $2}')
```

ç¡®è®¤ï¼š

```bash
echo $MASTER_IP
```

ä½¿ç”¨åˆšåˆšçš„`TOKEN`å’Œ`MASTER_IP`æ¥åˆ›å»ºä¸¤ä¸ªworkerèŠ‚ç‚¹  
å¹¶æŠŠå®ƒä»¬åŠ å…¥åˆ°é›†ç¾¤ä¸­

```bash
# åˆ›å»ºä¸¤ä¸ªworkerèŠ‚ç‚¹çš„è™šæ‹Ÿæœº
multipass launch --name worker1 --cpus 2 --memory 8G --disk 10G
multipass launch --name worker2 --cpus 2 --memory 8G --disk 10G

# åœ¨workerèŠ‚ç‚¹è™šæ‹Ÿæœºä¸Šå®‰è£…k3s
 for f in 1 2; do
     multipass exec worker$f -- bash -c "curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=\"https://$MASTER_IP:6443\" K3S_TOKEN=\"$TOKEN\" sh -"
 done
```

è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªå¤šèŠ‚ç‚¹çš„kubernetesé›†ç¾¤çš„æ­å»ºã€‚

## åœ¨çº¿å®éªŒç¯å¢ƒ

[Killercoda](https://killercoda.com/)

[Play-With-K8s](https://labs.play-with-k8s.com/)